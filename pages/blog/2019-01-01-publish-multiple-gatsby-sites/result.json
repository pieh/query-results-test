{
  "path": "/blog/2019-01-01-publish-multiple-gatsby-sites/",
  "result": {
    "data": {
      "mdx": {
        "body": "function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Publish Multiple Gatsby Sites in a Monorepo, Using Lerna, Travis & Now\",\n  \"date\": \"2019-01-01T00:00:00.000Z\",\n  \"author\": \"Andrico Karoulla\",\n  \"tags\": [\"apps\", \"testing\", \"deployment\"],\n  \"excerpt\": \"Learn how to create a balanced lasagna instead of a tangled mess of spaghetti.\"\n};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h2\", {\n    \"id\": \"learn-how-to-create-a-balanced-lasagna-instead-of-a-tangled-mess-of-spaghetti\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#learn-how-to-create-a-balanced-lasagna-instead-of-a-tangled-mess-of-spaghetti\",\n    \"aria-label\": \"learn how to create a balanced lasagna instead of a tangled mess of spaghetti permalink\",\n    \"className\": \"anchor\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"Learn how to create a balanced lasagna instead of a tangled mess of spaghetti.\"), mdx(\"h3\", {\n    \"id\": \"foreword\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"href\": \"#foreword\",\n    \"aria-label\": \"foreword permalink\",\n    \"className\": \"anchor\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"Foreword\"), mdx(\"p\", null, \"This tutorial will take about two hours to complete. If you\\u2019re unfamiliar with Lerna, Travis or Now, you may fall into a few traps, but it\\u2019s all part of the learning process! I\\u2019ve included a troubleshooting section at the end of the article for common problems, so refer to it at any time.\"), mdx(\"h3\", {\n    \"id\": \"introduction\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"href\": \"#introduction\",\n    \"aria-label\": \"introduction permalink\",\n    \"className\": \"anchor\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"Introduction\"), mdx(\"p\", null, \"If you work alone or in a small team, you\\u2019re likely to have started working on small programs that slowly grow complex and convoluted. Shit happens and you\\u2019ll soon find that your perfectly balanced lasagna evolves into a heaped bowlful of spaghetti.\"), mdx(\"p\", null, \"The same goes for those who have worked as part of a large company/team. Branding guidelines come in the form of css style-guides or reusable components. Separating the discrete packages from what\\u2019s shared becomes a hassle if everything\\u2019s stored together. You may even have to deal with several similar projects thrown about in different repos, which can be an headache to keep track of. These are some of the problems monorepos solve.\"), mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"786px\"\n    }\n  }), \"\\n      \", mdx(\"a\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/72822e30046f7c951f06907d80b27009/5df5c/monorepo-diagram.jpg\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": [\"noopener\"]\n  }), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"53.448275862068975%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIBBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAe4qTQf/xAAWEAEBAQAAAAAAAAAAAAAAAAAQATH/2gAIAQEAAQUCJj//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAVEAEBAAAAAAAAAAAAAAAAAAABIP/aAAgBAQAGPwJr/8QAHBAAAgICAwAAAAAAAAAAAAAAAAERMSFRYYHR/9oACAEBAAE/IctpXRnmtEreEkJiUKEf/9oADAMBAAIAAwAAABCQD//EABURAQEAAAAAAAAAAAAAAAAAAAAB/9oACAEDAQE/EFf/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAcEAEBAQABBQAAAAAAAAAAAAABEQAhUWGRseH/2gAIAQEAAT8QJiw8LJ9zCx8nnJBq9z01dcsVOUmIggb/2Q==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Monorepo Diagram\",\n    \"title\": \"Monorepo Diagram\",\n    \"src\": \"/static/72822e30046f7c951f06907d80b27009/a022f/monorepo-diagram.jpg\",\n    \"srcSet\": [\"/static/72822e30046f7c951f06907d80b27009/28bf1/monorepo-diagram.jpg 197w\", \"/static/72822e30046f7c951f06907d80b27009/afe26/monorepo-diagram.jpg 393w\", \"/static/72822e30046f7c951f06907d80b27009/a022f/monorepo-diagram.jpg 786w\", \"/static/72822e30046f7c951f06907d80b27009/5df5c/monorepo-diagram.jpg 1160w\"],\n    \"sizes\": \"(max-width: 786px) 100vw, 786px\",\n    \"loading\": \"lazy\"\n  })), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"A monorepo is an architectural design pattern that allows us to maintain several packages within a single repo. This reduces the complexity when dealing with packages that share in-house and third-party dependencies.\"), mdx(\"p\", null, \"Think of monorepos like a well-organised supermarket. Each aisle contains a particular kind of food, making it easy to navigate and find the item of food you want. Supermarkets also contain a variety of different foods so you don\\u2019t need to go to a series of specific shops to find your gluten-free, dairy-free banoffee pie (which is very much a \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://glutenfreecuppatea.co.uk/2016/02/14/recipe-healthy-banoffee-pie-gluten-free-vegan-refined-sugar-free-dairy-free/\"\n  }), \"thing\"), \").\"), mdx(\"p\", null, \"With monorepos the code is split into specific packages (aisles). Meaning you can easily navigate the project to find the component or module you want to work on. It also means not needing to maintain separate repos when making changes that affect multiple parts of your stack (the single shop).\"), mdx(\"p\", null, \"Everything is accessible from a single place, while still being organised enough to navigate painlessly.\\nEnough with the theory, let\\u2019s move on to the tutorial, which is split into 2 sections: development and deployment.\"), mdx(\"p\", null, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Development\"), \"\\u200A\\u2014\\u200AWe\\u2019ll configure an existing application, built with \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"/\"\n  }), \"Gatsby\"), \", into a monorepo. I won\\u2019t delve too much into its implementation details because it\\u2019s beyond the scope of this article. We\\u2019ll attend the lavish party that the great Gatsby throws for us and we won\\u2019t ask why or how they did it.\"), mdx(\"p\", null, \"Another tool we\\u2019ll use is \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/lerna/lerna\"\n  }), \"Lerna\"), \", which will manage the dependencies of our project. Lerna will also allow us to link packages together which we\\u2019ll use to share components.\"), mdx(\"p\", null, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Deployment\"), \"\\u200A\\u2014\\u200AAfter we\\u2019ve converted our app into a monorepo we\\u2019ll hook our GitHub account to Travis-CI and create a CI pipeline. The CI pipeline will test, build and deploy our application.\"), mdx(\"p\", null, \"There are a couple of caveats to address prior to beginning:\"), mdx(\"p\", null, \"Due to the scale of our demo site, you may feel that monorepos aren\\u2019t practical. You\\u2019ll be right in thinking that because a monorepo in this instance isn\\u2019t practical. There\\u2019ll be elements of duplication and rewriting that will seem counter productive. It\\u2019ll also seem like we\\u2019re over-engineering a simple site. The real learning comes from understanding how the pieces fit together on a small scale. You\\u2019ll be able to easily integrate monorepos at production level with your understanding of the fundamental concepts and underlying technologies.\"), mdx(\"p\", null, \"This tutorial deals with loads of small changes which make for plenty of opportunities for things to go wrong. I\\u2019ve tried making myself as clear as possible to prevent this but if you do come across issues then leave a descriptive comment. I\\u2019ll do my best to respond, edit and improve this article. You can also find the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/andrico1234/lerna-monorepo-finisher\"\n  }), \"finished repo here\"), \". There\\u2019s no shame in copying my code if you\\u2019re stuck.\"), mdx(\"p\", null, \"I\\u2019m also assuming fundamental web dev knowledge including experience with React, Git and the command line.\"), mdx(\"h3\", {\n    \"id\": \"part-one\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"href\": \"#part-one\",\n    \"aria-label\": \"part one permalink\",\n    \"className\": \"anchor\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"Part One\"), mdx(\"p\", null, \"Let\\u2019s begin! Navigate to an empty folder in the terminal and clone the repo by running the following command\"), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"git clone git@github.com:andrico1234/lerna-monorepo-starter.git\")), mdx(\"p\", null, \"and navigate into the the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"lerna-monorepo-starter\"), \" directory.\"), mdx(\"p\", null, \"Go to your GitHub account and create a new repo, this\\u2019ll be the repo that you push the site to so that Travis can run the pipeline. For those who need a refresher on how to \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://help.github.com/articles/creating-a-new-repository/\"\n  }), \"create a new repo\"), \". You may have to run \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"git remote remove origin\"), \" so you can point the code to your newly created repo.\"), mdx(\"p\", null, \"Run the code that GitHub outputs when creating a new repo:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"git remote add origin git@github.com:<account-name>/lerna-monorepo-starter.git\\ngit push -u origin master\\n\")), mdx(\"p\", null, \"Commit and push regularly for best results.\"), mdx(\"p\", null, \"Navigate inside of the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"lerna-monorepo-starter\"), \" directory and install the packages by running \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"yarn\"), \". Once your packages have installed, run \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"yarn develop\"), \" to run the application on localhost:8000.\"), mdx(\"p\", null, \"Open Chrome, and navigate to localhost:8000. You\\u2019ll find a simple application with a mock blog and a mock shop. Imagine this is a fleshed out application, we can make the assumption that the underlying logic behind the blog and the shop are different and that there are similarities with the styling and components.\"), mdx(\"p\", null, \"Go back to your IDE and you\\u2019ll see that we\\u2019re not pulling data from an external source. The data is being served locally via a couple of json files in the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"data\"), \" directory. When we run the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"develop\"), \" command Gatsby pulls the data from these json files and creates pages for them. You can take a look at how this being done by peeking inside of the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"gatsby-node.js\"), \" file. This is because Gatsby builds the code and outputs a static site.\"), mdx(\"p\", null, \"So imagine our application is starting to grow, the shop and the blog start intertwining with each other. You may not notice the lack of separation until its too late and your code is tangled tighter than the ivy across the side of your grandma\\u2019s cottage.\"), mdx(\"p\", null, \"Let\\u2019s start splitting up our application. I\\u2019ll only be touching the surface of what Lerna is capable of, so I\\u2019d recommend checking out their repo to learn more. Install Lerna with \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"yarn global add lerna\"), \". We need to create a file in the root directory called \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"lerna.json\"), \". Add in the following:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"{\\n  \\\"lerna\\\": \\\"2.11.0\\\",\\n  \\\"packages\\\": [\\n    \\\"packages/*\\\"\\n  ],\\n  \\\"npmClient\\\": \\\"yarn\\\",\\n  \\\"useWorkspaces\\\": true,\\n  \\\"version\\\": \\\"1.0.0\\\"\\n}\\n\")), mdx(\"p\", null, \"The above specifies the version of Lerna we\\u2019re using. We also let Lerna know where to find our packages, in this case the packages will be contained within a directory inside of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"packages\"), \". We specify that we\\u2019re using Yarn, the current version of our application and that we\\u2019re using Yarn Workspaces enables Lerna\\u2019s package hoisting. To enable Yarn workspaces, add the following to your \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"package.json\"), \" file.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"{\\n  ...rest of file,\\n  \\\"private\\\": true,\\n  \\\"workspaces\\\": [\\n    \\\"packages/*\\\"\\n  ]\\n}\\n\")), mdx(\"p\", null, \"Once that\\u2019s been completed create a new \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"packages\"), \" directory in the root of the project. Create three additional directories inside of it so the structure looks like the following:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"packages\\n | blog\\n | shared-ui\\n | shop\\n\")), mdx(\"p\", null, \"The next step is to move the contents from our current application into their respective folders. All the files in our \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"components\"), \" folder will be moved to our \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"shared-ui\"), \" directory since we\\u2019d like to be able to use them anywhere throughout our codebase.\"), mdx(\"p\", null, \"For now we\\u2019ll move everything over to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"shared-ui\"), \" components and import them using a relative url.\"), mdx(\"p\", null, \"Inside of the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"packages/shared-ui\"), \" directory, I\\u2019ve created a file called \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"index.js\"), \" which will be our entry point for importing components. This is the directory that we\\u2019re going to be moving our components folder into. Open up your terminal and navigate to the top level of your project directory and run\"), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"mv src/components/ packages/shared-ui/components/\")), mdx(\"p\", null, \"This will move the components into their brand new home. Go ahead and do the same for the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"theme\"), \" directory too. You\\u2019re going to need to fix the now broken import statements for each component that uses the theme object.\"), mdx(\"p\", null, \"The Layout component behaves as the entry point of each Gatsby application, which means that each package will need one.\"), mdx(\"p\", null, \"We\\u2019ll avoid code duplication by abstracting the parts of the layout that won\\u2019t need to change based on the page, like the use of the Header component. We\\u2019ll keep each package\\u2019s individual logic, like the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"graphql\"), \" query.\"), mdx(\"p\", null, \"In \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"packages/shared-ui\"), \", create a new directory called \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"layouts/PrimaryLayouts\"), \". Create an \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"index.js\"), \" file and move over the contents of the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"src/layouts/index.js\"), \" file here. Once that\\u2019s done get rid of the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"graphql\"), \" query. Move over the css file so the imports don\\u2019t break.\"), mdx(\"p\", null, \"Back in the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"src/layouts\"), \" file we can get rid of everything and replace it with this:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-jsx:title=layout/index.js\"\n  }), \"import React from \\\"react\\\"\\nimport PropTypes from \\\"prop-types\\\"\\n\\nimport { PrimaryLayout } from \\\"../../packages/shared-ui\\\"\\n\\nconst Layout = ({ children, data }) => (\\n  <PrimaryLayout children={children} data={data} />\\n)\\n\\nLayout.propTypes = {\\n  children: PropTypes.func,\\n}\\n\\nexport default Layout\\n\\nexport const query = graphql`\\n  query SiteTitleQuery {\\n    site {\\n      siteMetadata {\\n        title\\n      }\\n    }\\n  }\\n`\\n\")), mdx(\"p\", null, \"Once that\\u2019s done update the export statements in \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"the shared-ui/index.js\"), \" file to look like the following.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-jsx:title=index.js\"\n  }), \"export { default as theme } from \\\"./theme\\\"\\n\\nexport { default as Button } from \\\"./components/Button\\\"\\nexport { default as Header } from \\\"./components/Header\\\"\\nexport { ItemCard, ItemCardWrapper } from \\\"./components/ItemCard\\\"\\n\\nexport { default as PrimaryLayout } from \\\"./layouts/PrimaryLayouts\\\"\\n\")), mdx(\"p\", null, \"Your packages folder hierarchy should look like this now\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"packages\\n  | blog\\n  | shared-ui\\n    | index.js\\n    | components\\n      | Button\\n        | index.js\\n      | Header\\n        | index.js\\n      | ItemCard\\n        | index.js\\n    | theme\\n      | index.js\\n    | layouts\\n      | PrimaryLayout\\n        | index.js\\n        | index.css\\n  | shop\\n\")), mdx(\"p\", null, \"It\\u2019s likely that your project won\\u2019t run because the import statements for your shared components will have broken. The way the project\\u2019s set up means that we can do a find-and-replace to find \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"../components/{specific-component}\"), \" and replace it with \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"../../packages/shared-ui\"), \". The site will still be broken because we need to wrap the import name with curly braces, so the import statement looks like this:\"), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"import { Header } from \\u2018../../packages/shared-ui\\u2019\")), mdx(\"p\", null, \"Just make sure the Header import for your \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"PrimaryLayout/index.js\"), \" is as follows \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"import { Header } from '../../'\"), \". Once you\\u2019ve replaced all the outdated import statements with new ones, try running your application again. We should expect to see no errors in the console. Now\\u2019s a good time to commit and push the code.\"), mdx(\"p\", null, \"Now we\\u2019ve got this working, we want to take it one step further and make the shared-ui behave in the same way a public package does. Create a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"package.json\"), \" file inside of the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"shared-ui\"), \" package and add the following:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-json:title=package.json\"\n  }), \"{\\n  \\\"name\\\": \\\"@lerna-monorepo/shared-ui\\\",\\n  \\\"description\\\": \\\"Lerna monorepo starter\\\",\\n  \\\"version\\\": \\\"1.0.2\\\",\\n  \\\"dependencies\\\": {\\n    \\\"gatsby\\\": \\\"^1.9.247\\\",\\n    \\\"gatsby-link\\\": \\\"^1.6.40\\\",\\n    \\\"gatsby-plugin-react-helmet\\\": \\\"^2.0.10\\\",\\n    \\\"gatsby-plugin-react-next\\\": \\\"^1.0.11\\\",\\n    \\\"react\\\": \\\"16.4.2\\\",\\n    \\\"react-helmet\\\": \\\"^5.2.0\\\",\\n    \\\"styled-components\\\": \\\"^3.3.3\\\"\\n  },\\n  \\\"license\\\": \\\"MIT\\\",\\n  \\\"repository\\\": {\\n    \\\"type\\\": \\\"git\\\",\\n    \\\"url\\\": \\\"https://github.com/gatsbyjs/gatsby-starter-default\\\"\\n  }\\n}\\n\")), mdx(\"p\", null, \"This will add the necessary dependencies for our \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"shared-ui\"), \" package.\"), mdx(\"p\", null, \"Now we\\u2019re going to want to split up our original application into two separate packages; blog and shop. We\\u2019re going to need to mimic the current hierarchy to ensure that Gatsby keeps working. Each package will have a:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"data directory\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"src directory with layouts and pages\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"gatsby-config.js\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"gatsby-node.js\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"package.json file\")), mdx(\"p\", null, \"Go ahead and create blank folders/files for each item in the list above inside of each package. We\\u2019ll go through each item one by one for the blog package, then I\\u2019ll leave you to implement this for the shop package. You can refer to the finished repo at anytime if you\\u2019re stuck.\"), mdx(\"p\", null, \"Data directory\\u200A\\u2014\\u200AMove the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"blog.json\"), \" file in the top level \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"data\"), \" directory. Go to your console, move to the repo\\u2019s top level directory and execute the following command \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"mv data/blog.json packages/blog/data/blog.json\"), \". This moves our mock blog data into its rightful home.\"), mdx(\"p\", null, \"Src directory with layouts and pages\\u200A\\u2014\\u200AIn \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"packages/blog/src/layouts\"), \", create an \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"index.js\"), \" file. Copy and paste the contents of the top level \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"src/layouts/index.js\"), \" file. Your IDE might start shouting at you because \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"../../packages/shared-ui\"), \" is no longer a valid import location. We finally get to use the brand spanking new \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"shared-ui\"), \" package we created earlier on. Change the old import location to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"@lerna-monorepo/shared-ui\"), \". Create two new files inside the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"packages/blog/src/pages/\"), \" directory with the file name of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"index.js\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"blogItem.js\"), \". In the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"index.js\"), \" file copy the contents of the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"blog.js\"), \" file under the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"src/pages/\"), \" directory. Update the import for the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"shared-ui\"), \" package like we did for the index file. Do the same for the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"blogItem.js\"), \" file. You\\u2019ll need to change the \\u2018back to blog\\u2019 to attribute in this file to \\u2018/\\u2019.\"), mdx(\"p\", null, \"gatsby-config.js\\u200A\\u2014\\u200AAgain, copy the contents of the top level \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"gatsby-config.js\"), \" file with the one in the blog package.\"), mdx(\"p\", null, \"gatsby-node.js\\u200A\\u2014\\u200AWe\\u2019ll only know whether everything works or if our site craps itself once we move this file and add the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"package.json\"), \". We want to copy over only the logic relating to the processing of the blog data. Copy and paste everything into the empty \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"gatsby-node.js\"), \" file. Remove all the lines between and including 6\\u201333, as well as the bottom most right curly bracket, and the right parenthesis on the second to last line.\"), mdx(\"p\", null, \"package.json- Add the following to the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"package.json\"), \" file:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-json:title=package.json\"\n  }), \"{\\n  \\\"name\\\": \\\"@lerna-monorepo/blog\\\",\\n  \\\"description\\\": \\\"Lerna monorepo starter\\\",\\n  \\\"version\\\": \\\"1.0.2\\\",\\n  \\\"dependencies\\\": {\\n    \\\"@lerna-monorepo/shared-ui\\\": \\\"^1.0.1\\\",\\n    \\\"gatsby\\\": \\\"^1.9.247\\\",\\n    \\\"gatsby-link\\\": \\\"^1.6.40\\\",\\n    \\\"gatsby-plugin-react-helmet\\\": \\\"^2.0.10\\\",\\n    \\\"gatsby-plugin-react-next\\\": \\\"^1.0.11\\\",\\n    \\\"gatsby-react-router-scroll\\\": \\\"^1.0.18\\\",\\n    \\\"gatsby-source-filesystem\\\": \\\"^1.5.39\\\",\\n    \\\"gatsby-transformer-json\\\": \\\"^1.0.20\\\",\\n    \\\"react\\\": \\\"^16.4.2\\\",\\n    \\\"react-helmet\\\": \\\"^5.2.0\\\",\\n    \\\"react-router-dom\\\": \\\"4.3.1\\\",\\n    \\\"serve\\\": \\\"^10.0.0\\\",\\n    \\\"styled-components\\\": \\\"^3.3.3\\\"\\n  },\\n  \\\"license\\\": \\\"MIT\\\",\\n  \\\"scripts\\\": {\\n    \\\"start\\\": \\\"serve public/\\\",\\n    \\\"build\\\": \\\"gatsby build\\\",\\n    \\\"develop\\\": \\\"gatsby develop\\\"\\n  }\\n}\\n\")), mdx(\"p\", null, \"As well as the dependencies we defined in our top level \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"package.json\"), \" file, I\\u2019ve added a couple more that we\\u2019ll use later. You won\\u2019t need to worry about what they do for now.\"), mdx(\"p\", null, \"Note: In your top level \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"package.json\"), \" change the version of React to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"16.0.0\"), \". I explain why in the troubleshooting section at the bottom of the article.\"), mdx(\"p\", null, \"You should notice that we\\u2019ve added \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"\\\"@lerna-monorepo/shared-ui\\\": \\\"^1.0.0\\\"\"), \" to the list dependencies. This will treat our \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"shared-ui\"), \" package as a standard node module. Run \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"lerna clean\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"lerna bootstrap\"), \" to update your packages.\"), mdx(\"p\", null, \"Once you\\u2019ve done this, try navigating to the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"packages/blog\"), \" directory and running \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"yarn develop\"), \". Hopefully everything compiles and you should be able to access the homepage. Because the shop hasn\\u2019t been implemented, trying to navigate to that part of the application will result in failure. Go ahead and do the same for the shop package.\"), mdx(\"p\", null, \"Here\\u2019s the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"package.json\"), \" file for the shop package:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-json:title=package.json\"\n  }), \"{\\n  \\\"name\\\": \\\"@lerna-monorepo/shop\\\",\\n  \\\"description\\\": \\\"Lerna monorepo finisher\\\",\\n  \\\"version\\\": \\\"1.0.2\\\",\\n  \\\"dependencies\\\": {\\n    \\\"@lerna-monorepo/shared-ui\\\": \\\"^1.0.1\\\",\\n    \\\"gatsby\\\": \\\"^1.9.247\\\",\\n    \\\"gatsby-link\\\": \\\"^1.6.40\\\",\\n    \\\"gatsby-plugin-react-helmet\\\": \\\"^2.0.10\\\",\\n    \\\"gatsby-plugin-react-next\\\": \\\"^1.0.11\\\",\\n    \\\"gatsby-source-filesystem\\\": \\\"^1.5.39\\\",\\n    \\\"gatsby-transformer-json\\\": \\\"^1.0.20\\\",\\n    \\\"gatsby-react-router-scroll\\\": \\\"^1.0.18\\\",\\n    \\\"react\\\": \\\"^16.4.2\\\",\\n    \\\"react-helmet\\\": \\\"^5.2.0\\\",\\n    \\\"react-router-dom\\\": \\\"4.3.1\\\",\\n    \\\"serve\\\": \\\"^10.0.0\\\",\\n    \\\"styled-components\\\": \\\"^3.3.3\\\"\\n  },\\n  \\\"license\\\": \\\"MIT\\\",\\n  \\\"scripts\\\": {\\n    \\\"start\\\": \\\"serve public\\\",\\n    \\\"build\\\": \\\"gatsby build\\\",\\n    \\\"develop\\\": \\\"gatsby develop -p 8001\\\"\\n  }\\n}\\n\")), mdx(\"p\", null, \"I\\u2019ve made a slight change in this file, so that running both packages won\\u2019t cause a port clash. If you can navigate to both packages and run \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"yarn develop\"), \" without the script throwing an error, then commit and push your changes.\"), mdx(\"p\", null, \"There are two major issues we need to address:\"), mdx(\"p\", null, \"Having to run each package manually is a pain.\\nOur website doesn\\u2019t recognise that we\\u2019re linking between two different packages.\\nWe\\u2019ll resolve the first issue by creating a top level script that runs both the blog and shop in parallel. The second issue we\\u2019ll solve by adding \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \".env\"), \" variables that will hold the addresses for the blog/shop urls. The variables will be different for the production environment and will hold the live urls.\"), mdx(\"p\", null, \"Add the following to the scripts block of your top level \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"package.json\"), \" file.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-json:title=package.json\"\n  }), \"\\\"scripts\\\": {\\n  \\\"run:blog\\\": \\\"cd packages/blog && yarn develop\\\",\\n  \\\"run:shop\\\": \\\"cd packages/shop && yarn develop\\\",\\n  \\\"run:all\\\": \\\"npm-run-all --parallel run:blog run:shop\\\"\\n}\\n\")), mdx(\"p\", null, \"The first two run each package\\u2019s Gatsby server individually, while the latter uses \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"npm-run-all\"), \" to run the scripts in parallel. Install \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"npm-run-all\"), \" using \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"lerna add npm-run-all\"), \" in the top level of your project.\"), mdx(\"p\", null, \"Note: \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"npm-run-all\"), \" runs both Gatsby instances in the same terminal window. So logging for both the shop and blog outputs to the same window. You\\u2019ll need to press cmd+d twice to kill the Gatsby process.\"), mdx(\"p\", null, \"To navigate between both our Gatsby sites on development we\\u2019re going to need to add environment variables so to use with the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Link\"), \" components. We\\u2019ll add the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"dotenv\"), \" package so Gatsby knows which variables to load for a given environment.\"), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"lerna add dotenv --scope=*{@lerna-monorepo/shop,@lerna-monorepo/blog}*\")), mdx(\"p\", null, \"This adds the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"dotenv\"), \" module to only the blog and shop packages, this way we don\\u2019t add unnecessary dependencies to our \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"shared-ui\"), \" package.\"), mdx(\"p\", null, \"Create a new file in your shop package called \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \".env.development\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \".env.production\"), \". Inside the former, add the following line:\"), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"BLOG_URL=https://localhost:8000\")), mdx(\"p\", null, \"Leave the production file alone for now and repeat for blog package, just change the name of the variable to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"SHOP_URL\"), \" and the port to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"8001\"), \".\"), mdx(\"p\", null, \"Now add the following code to the top of your \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"gatsby-config.js\"), \" file in your shop package.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-jsx:title=gatsby-config.js\"\n  }), \"const activeEnv = process.env.ACTIVE_ENV | \\\"development\\\"\\n\\nrequire(\\\"dotenv\\\").config({\\n  path: `.env.${activeEnv}`,\\n})\\n\")), mdx(\"p\", null, \"Add this code to the blog\\u2019s \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"gatsby-config.js\"), \" file too. This code snippet will give you access to these variables inside of our components. We can provide different sets of variables depending on the current environment. When we later run gatsby build to create our static site, it will use the production variables.\"), mdx(\"p\", null, \"Once we\\u2019ve add that, we\\u2019re going to need to find all instances where we navigate from the blog site to the shop site and vice versa, you\\u2019ll need to replace the current Links to:\"), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"<a href={process.env.SHOP_URL}>Back to Shop</a>\")), mdx(\"p\", null, \"Protip: they\\u2019re in \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"shop/src/pages/index.js\"), \", and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"blog/src/pages/index.js\"), \".\"), mdx(\"p\", null, \"This will allow us to transition between our two sites. Do the same for the shop package and you\\u2019ll be able to use the site as normal. If \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"yarn run:all\"), \" still works and you can run \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"yarn build\"), \" for each package then commit and push the changes. In each package run \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"yarn serve\"), \" go to the correct port to double-check that everything displays correctly.\"), mdx(\"p\", null, \"Congratulations, the site now behaves in exactly the same way as when we started. This might make it seem like monorepos have little use, but you\\u2019ll find that using a monorepo is a way of keeping packages independent from each other while easily reusing assets.\"), mdx(\"p\", null, \"You can stop the tutorial now and you\\u2019ll have a working knowedge of when, how and why to use monorepos, but the latter half of this tutorial will show us how we can take things a step further. We\\u2019ll get a CI pipeline set up for our application and deploy it on success.\"), mdx(\"h3\", {\n    \"id\": \"part-two\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"href\": \"#part-two\",\n    \"aria-label\": \"part two permalink\",\n    \"className\": \"anchor\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"Part Two\"), mdx(\"p\", null, \"Let\\u2019s take a second to reflect on where we are right now. We\\u2019ve managed to start with a single application with two discrete sections and split them apart in a monorepo. This allows us to \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"separate the concerns\"), \" and share reusable components.\"), mdx(\"p\", null, \"There are two parts to this section, our Continuous Integration (CI) pipeline and the site\\u2019s deployment. Our CI pipeline will be used to automate a series of checks to ensure our tests pass and our build compiles. If either of these, or any part of the pipeline, fails then our site won\\u2019t deploy. The second part is how we deal with a successful build, and that\\u2019s deployment! If everything passes, our site will deploy using Now, where it will be hosted for the world to see on the interwebs.\"), mdx(\"p\", null, \"To use Travis we\\u2019ll first need to create an account and add the GitHub repo we\\u2019ve been pushing to. And like with every other tool we\\u2019ve used, the best way to get started with Travis is by reading \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://docs.travis-ci.com/user/getting-started/\"\n  }), \"Travis\\u2019 getting started page\"), \". The getting started page also runs through adding your GitHub repo which can be done via the main page. Click the \\u2018+\\u2019 and on your profile page click \\u2018Manage repositories in GitHub\\u2019. Choose the repo that you\\u2019ve been using and you should be set up.\"), mdx(\"p\", null, \"Once you\\u2019ve done this we\\u2019ll create our \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \".travis.yml\"), \" which outlines the steps our CI pipeline will take when preparing for deployment. Travis won\\u2019t recognise any application that doesn\\u2019t have a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \".travis.yml\"), \", so we\\u2019ll create a basic one. Once we push code that contains a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \".travis.yml\"), \" file, the CI pipeline will start running on every subsequent push.\"), mdx(\"p\", null, \"In the root of your project create a file named \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \".travis.yml\"), \". And please, please, pleaaase make sure you\\u2019ve spelt the file name correctly. I was racking my head for the best part of an hour wondering why my build wasn\\u2019t running, only to discover I had left out the leading period in the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \".travis.yml\"), \".\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-yaml:title=.travis.yml\"\n  }), \"language: node_js\\nnode_js:\\n  - \\\"10.9.0\\\"\\n\")), mdx(\"p\", null, \"This is the absolute least we can do for our CI pipeline, we\\u2019re telling Travis that we\\u2019re using node version 10.9.0. Note: I only chose 10.9.0 because it\\u2019s the latest stable version of Node available at the time of writing. To find out what version you\\u2019re on, type \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"node -v\"), \" in the command line and declare that version in your \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \".travis.yml\"), \" file. We don\\u2019t want any discrepancies between our development environment and our production build, so we\\u2019ll use keep the version of Node we\\u2019re using consistent.\"), mdx(\"p\", null, \"Once you\\u2019ve done this, commit your changes and push them forward. Travis should recognise your \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \".travis.yml\"), \" file and starts running the pipeline.\"), mdx(\"p\", null, \"You should be getting feedback from Travis about your builds, and that they\\u2019re failing. This is expected as by default, travis runs a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"yarn test\"), \" as part of its pipeline. We have no tests so error code 1 is thrown causing the pipeline to fail. To get this passing, we\\u2019ll add a token test to our codebase. In \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"blog/src/pages\"), \" create a new file \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"blogitem.test.js\"), \" and add the following:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-jsx:title=blogItem.test.js\"\n  }), \"import React from \\\"react\\\"\\nimport { shallow } from \\\"enzyme\\\"\\nimport BlogItem from \\\"./blogItem\\\"\\n\\ndescribe(\\\"Layout component\\\", () => {\\n  const mockProps = {\\n    pathContext: {\\n      data: {\\n        title: \\\"mock title\\\",\\n        content: \\\"mock content\\\",\\n        href: \\\"google.com\\\",\\n      },\\n    },\\n  }\\n\\n  it(\\\"should render\\\", () => {\\n    const wrapper = shallow(<BlogItem {...mockProps} />)\\n\\n    expect(wrapper)\\n  })\\n})\\n\")), mdx(\"p\", null, \"We\\u2019re using Enzyme, a package that lets us test React components by rendering the component in a virtual DOM. For the sake of the tutorial, we\\u2019re doing the enzyme equivalent of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"expect(true).toBe(true)\"), \". Now go into the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"package.json\"), \" file for blog and add \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"jest test --config ../../jest-config.json\"), \" to the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"test\"), \" field under \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"scripts\"), \". Once you\\u2019ve done this, navigate to the blog package in the command line and run \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"yarn test\"), \", your should test pass. Go ahead and do the same for shop package\\u2019s \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"shoppingItem\"), \" component.\"), mdx(\"p\", null, \"Note: you\\u2019ll likely need \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"react-router-dom\"), \" specified as a dependency to get the tests working. I elaborate more on this in the troubleshooting section below. Also make sure you\\u2019ve get \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"jest\"), \" installed globally, if not then run \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"yarn global add jest\"), \" in your command line. Test to see that \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"yarn build\"), \" still works for each package, as it\\u2019s going to be the next step in our pipeline.\"), mdx(\"p\", null, \"Before we push, we need to make a couple more changes to our pipeline. Update your \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \".travis.yml\"), \" file so it looks like the following:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-yml:title=travis.yml\"\n  }), \"language: node_js\\nnode_js:\\n  - \\\"10.9.0\\\"\\n\\ncache: yarn\\n\\ninstall:\\n  - yarn global add lerna jest\\n  - lerna bootstrap\\n\\nscript:\\n  - yarn test\\n  - yarn build\\n\")), mdx(\"p\", null, \"The additions include caching Yarn, installing the global dependencies, and specifying that we want to run \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"yarn test\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"yarn build\"), \" as part of our pipeline.\"), mdx(\"p\", null, \"Run \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"yarn test\"), \" one last time in your command line to make sure that everything still works. If it does then push your code to kick off the CI pipeline. Keep Travis-CI open in your web browser so you can watch the feedback for each CI step. If Travis throws up a bunch of red all over your screen, then it looks like something\\u2019s gone wrong. If this is the case, try running everything locally to see if it still works. A common error is using a global package locally that we haven\\u2019t explicitly specified in our \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \".travis.yml\"), \" file. This means that Travis won\\u2019t have access to it when running the pipeline. Travis normally gives good logging to give clues as to why your pipeline failed, so it\\u2019s worth digging through them.\"), mdx(\"p\", null, \"There are two more sections we need to add to our \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \".travis.yml\"), \" file\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Handling the individual scripts for each package.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Handling deployment when the pipeline passes.\")), mdx(\"p\", null, \"We won\\u2019t worry about the latter for now, but let\\u2019s deal with running scripts for different repos. Because we\\u2019re not going to be deploying our \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"shared-ui\"), \" we can skip it from our CI pipeline. We\\u2019ll run \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"yarn test\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"yarn build\"), \" for both the blog and the shop.\"), mdx(\"p\", null, \"We\\u2019ll do this by adding a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"matrix\"), \" step right after the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"install\"), \" step to the CI pipeline. This \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"matrix\"), \" step will let us specify which packages we want to run the CI pipeline on. We\\u2019ll name each matrix and set a environment variables for the package location. We\\u2019ll then change the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"script\"), \" step so Travis moves into the correct directory and runs the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"script\"), \" step. Delete everything after the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"install\"), \" step and add the following:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"matrix:\\n  include:\\n    - name: \\\"Blog Pipeline\\\"\\n      env: PACKAGE_LOCATION=packages/blog\\n    - name: \\\"Shop Pipeline\\\"\\n      env: PACKAGE_LOCATION=packages/shop\\nscript:\\n  - cd $PACKAGE_LOCATION\\n  - yarn test\\n  - yarn build\\n\")), mdx(\"p\", null, \"Hopefully what I\\u2019ve said makes more sense with the code in front of us. The \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"script\"), \" pipeline runs for each step we\\u2019ve included in the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"matrix\"), \". We\\u2019ve also added another step to the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"script\"), \" section, this is doing nothing more than moving to the directory of the current package. Push the changes again to your repo and open Travis to see your pipeline running. You should now be seeing two build jobs running simultaneously, which means our matrix is working. If everything passes, we\\u2019ll move on to deploying our application.\"), mdx(\"h3\", {\n    \"id\": \"now\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"href\": \"#now\",\n    \"aria-label\": \"now permalink\",\n    \"className\": \"anchor\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"Now\"), mdx(\"p\", null, \"Now is a tool created by ZEIT that makes the process of deploying Node applications simple. Now has recently released updates to the way they deploy static websites. Fortunately our Gatsby packages build to static sites, so it\\u2019s a win for us.\"), mdx(\"p\", null, \"If you haven\\u2019t used Now before, then go-ahead and \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://zeit.co/now#features\"\n  }), \"get started\"), \". This will install the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"now-cli\"), \" and get a free account created, things we need for the tutorial. The getting started page also has a brief FAQs section that\\u2019s well worth reading.\"), mdx(\"p\", null, \"Travis-CI isn\\u2019t permitted to deploy to your Now account by default, and requires a token. You can create a token via the Account Settings page on the Now website. Once you\\u2019re there click the tokens tab and create a new token. Copy it to your clipboard, as we\\u2019ll be adding to the list of variables that Travis uses in our pipelines. Go to your lerna-monorepo repository in Travis and from the \\u2018More options\\u2019 drop down, click \\u2018settings\\u2019. When you\\u2019re here, you\\u2019ll see a section called \\u2018environment variables\\u2019. Create a new variable called \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"NOW_TOKEN\"), \" and paste your Now public key as the value. We can now reference the key from within our \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \".travis.yml\"), \" file.\"), mdx(\"p\", null, \"We\\u2019ll add the final part of our pipeline now, which deals with deployment. Make sure your \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \".travis.yml\"), \" file looks like the following, and we\\u2019ll run through the additions.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-yml:title=.travis.yml\"\n  }), \"language: node_js\\nnode_js:\\n  - \\\"10.9.0\\\"\\n\\ncache: yarn\\n\\ninstall:\\n  - yarn global add lerna jest now\\n  - lerna bootstrap\\n\\nmatrix:\\n  include:\\n    - name: Blog Pipeline\\n      env: PACKAGE_LOCATION=packages/blog PACKAGE_NAME=lerna-monorepo-blog\\n    - name: Shop Pipeline\\n      env: PACKAGE_LOCATION=packages/shop PACKAGE_NAME=lerna-monorepo-shop\\n\\nscript:\\n  - cd $PACKAGE_LOCATION\\n  - yarn test\\n  - yarn build\\n\\ndeploy:\\n  provider: script\\n  script: now public --token $NOW_TOKEN\\n  skip_cleanup: true\\n  app: $PACKAGE_NAME\\n\")), mdx(\"p\", null, \"Note that we\\u2019ve added some additional environment variables to our matrix so and them in there. There are huge changes we\\u2019ve made to the end of the file so let\\u2019s go through them line by line:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"deploy\\u200A\\u2014\\u200Aspecifies the step of the pipeline; the deployment step.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"provider\\u200A\\u2014\\u200Atells the name of the script to run for deployment, in this case it\\u2019s \\u2018script\\u2019\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"skip_cleanup\\u200A\\u2014\\u200Awe don\\u2019t want Travis to get rid of any files made during the build. We created the \\u2018public\\u2019 folder when running the build, so we don\\u2019t want Travis to get rid of it.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"app\\u200A\\u2014\\u200Aspecifies the name of the application we\\u2019re deploying,\")), mdx(\"p\", null, \"We have to do add a little bit of configuration on our side to ensure that Now hosts our sites correctly. The config comes in the form of a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"now.json\"), \" file, which outlines the options we want Now to use when deploying our site. Go into the directory for our blog packages and create a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"now.json\"), \" file. We want to let Now know that we\\u2019re deploying a static site, the entry directory to the static site, and what alias we want to assign our site. Put this inside your \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"now.json\"), \" file.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-jsx:title=now.json\"\n  }), \"{\\n  \\\"type\\\": \\\"static\\\",\\n  \\\"alias\\\": \\\"lerna-monorepo-blog\\\",\\n  \\\"static\\\": {\\n    \\\"public\\\": \\\"public\\\"\\n  },\\n  \\\"public\\\": true,\\n  \\\"version\\\": 1\\n}\\n\")), mdx(\"p\", null, \"Note: \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"public: true\"), \" needs to be specified since you\\u2019ll most likely have a free Now account. Having a publicly facing site is one of the restrictions of the free tier. The entry file to our static site is also called \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"public\"), \" so don\\u2019t conflate the two.\"), mdx(\"p\", null, \"Push these changes to your repo to kick off your build pipeline. If everything was successful then your build will have passed and your site will have deployed. Go to Travis, open up your blog build so you have access to the logs. Scroll right to the bottom to where it says \\u2018deploying application\\u2019 and uncollapse the section. This\\u2019ll be the URL that Now deployed your site to. It should look something like \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"https://buildsjdoe383jd.now.sh\"), \". Copy that url and go back to your command line. Run the following command:\"), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"now alias <your randomly generated URL> <your chosen alias>\"), \"\\nI chose \\u2018lerna-monorepo-blog\\u2019 as my alias, so that one won\\u2019t be available for you to use, so choose your own. When you\\u2019ve run the command, there will be feedback saying that the alias was successfully created. If not, then it\\u2019s likely the command was written incorrectly or the alias is already in use by someone else. Once you\\u2019ve added an alias successfully for the blog, do the same for your shop package.\"), mdx(\"p\", null, \"Even if you push everything forward now the site\\u2019s navigation will still be broken. The very last thing we need to do is add our alias URL as an environment variables in our \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \".env.production\"), \" file. In your blog package\\u2019s \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \".env.production\"), \" go ahead and add the following:\"), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"BLOG_URL=https://<your chosen alias>.now.sh/\")), mdx(\"p\", null, \"Do the same for your shop url, commit and push. Congrats!\"), mdx(\"h3\", {\n    \"id\": \"thanks-for-reading\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"href\": \"#thanks-for-reading\",\n    \"aria-label\": \"thanks for reading permalink\",\n    \"className\": \"anchor\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"Thanks for reading!\"), mdx(\"p\", null, \"You should now be able to access the site and navigate easily between your shop and your blog. Great job!\"), mdx(\"p\", null, \"If you enjoyed the article or have any questions, please reach out to me on \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://twitter.com/andricokaroulla?lang=en\"\n  }), \"twitter\"), \"!\"), mdx(\"p\", null, \"You can find a variety of JavaScript related articles \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://medium.com/@andricokaroulla\"\n  }), \"here\")), mdx(\"p\", null, \"I\\u2019m also running a \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.eventbrite.com/e/gatsbyjs-workshop-develop-and-deploy-your-own-blog-tickets-52432622385?aff=GatsbyBlog\"\n  }), \"Gatsby workshop\"), \" in London, February 2019.\"), mdx(\"h3\", {\n    \"id\": \"troubleshooting\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"href\": \"#troubleshooting\",\n    \"aria-label\": \"troubleshooting permalink\",\n    \"className\": \"anchor\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"Troubleshooting\"), mdx(\"p\", null, \"I\\u2019ll be adding to this section as I get feedback or stumble across issues myself.\"), mdx(\"p\", null, \"If you get an error that says \\u2018lerna: command not found\\u2019 after installing it globally, then install it locally as a project dependency and run it using \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"yarn lerna <command>\"), \".\"), mdx(\"p\", null, \"Running your application:\"), mdx(\"p\", null, \"A lot can go wrong in the first half of the application, so make sure that your files sit in their correct place. Also check you\\u2019re importing from the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"shared-ui\"), \" package correctly.\"), mdx(\"p\", null, \"My first go to when the application doesn\\u2019t work as expected is to run \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"lerna clean\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"lerna bootstrap\"), \". This clears all of your \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"node_modules\"), \" and reinstalls them.\"), mdx(\"p\", null, \"You need \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"react\"), \" specified in the package level \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"package.json\"), \" file to run your application. And you\\u2019ll also need \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"react\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"react-router-dom\"), \" specified in the top-level \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"package.json\"), \" to run the tests. This left me stumped, and the only logical reason why I think this happens is because Gatsby only seems to look for React in the package level \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"node_modules\"), \" directory, Since the tests are run from the top level, React also needs to exist there.\"), mdx(\"p\", null, \"My suggestion would be to have the package level react dependency the latest version of React, while the top-level react dependency as version 16.0.0.\"), mdx(\"p\", null, \"Running the pipeline for your application:\"), mdx(\"p\", null, \"If your CI pipeline isn\\u2019t deploying your site correctly, it can be difficult to distinguish whether or not it\\u2019s an issue with Travis or an issue with Now. If you can navigate to one of your package directory and run now, and everything\\u2019s successful, then it\\u2019s likely an issue with your \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \".travis.yml\"), \" file or the way in which your defining your environment variables in Travis. Go over that section one more time to make sure you\\u2019ve got it all written as it should be.\"), mdx(\"p\", null, \"Deploying your application:\"), mdx(\"p\", null, \"If running the now command in your package throws an error, then make sure you\\u2019re logged in to now via the CLI. You can do this via now login. Make sure that your \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"now.json\"), \" file points to the correct output of yarn build. It may be your version of Gatsby doesn\\u2019t create a build directory called \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"public\"), \" but instead \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"dist\"), \" or \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"build\"), \".\"), mdx(\"p\", null, \"Viewing your live application:\"), mdx(\"p\", null, \"Chances are that you might need to deploy your site more than once before everything works, lord knows I did when writing this application. One thing that tripped me up was client-side caching. Which is something that Now does out of the box. It just means that even if you\\u2019ve deployed a new version of the site, you might be viewing an older, cached version. If this is the case, open the Chrome/browser dev tools, right-click the reload symbol, and click \\u2018empty cache and hard reload\\u2019.\"));\n}\n;\nMDXContent.isMDXComponent = true;",
        "excerpt": "Learn how to create a balanced lasagna instead of a tangled mess of spaghetti.",
        "timeToRead": 18,
        "fields": {
          "slug": "/blog/2019-01-01-publish-multiple-gatsby-sites/",
          "publishedAt": null
        },
        "frontmatter": {
          "title": "Publish Multiple Gatsby Sites in a Monorepo, Using Lerna, Travis & Now",
          "excerpt": "Learn how to create a balanced lasagna instead of a tangled mess of spaghetti.",
          "date": "January 1st 2019",
          "rawDate": "2019-01-01T00:00:00.000Z",
          "canonicalLink": null,
          "tags": [
            "apps",
            "testing",
            "deployment"
          ],
          "image": null,
          "imageAuthor": null,
          "imageAuthorLink": null,
          "imageTitle": null,
          "showImageInArticle": null,
          "author": {
            "id": "Andrico Karoulla",
            "bio": "Software Developer x Bedroom Musician x andri.co",
            "twitter": "@andricokaroulla",
            "avatar": {
              "childImageSharp": {
                "fixed": {
                  "tracedSVG": "data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='32'%20height='32'%3e%3crect%20width='100%25'%20height='100%25'%20fill='%23f6f2f8'/%3e%3cpath%20d='M0%2012v13h3c3%200%204%201%204%204v3h12l-1-3c0-4%200-4%203-4l7-1h5V0H0v12m0%201c0%207%201%2010%201%206a133%20133%200%2000-1-6m17%202c-2%200%200%202%202%202l2-1c-1-2-2-2-4-1'%20fill='%23e0d6eb'%20fill-rule='evenodd'/%3e%3c/svg%3e",
                  "width": 64,
                  "height": 64,
                  "src": "/static/4b90edbe83ec53e57fb0cf1f4af840bc/88ae8/andrico-karoulla.jpg",
                  "srcSet": "/static/4b90edbe83ec53e57fb0cf1f4af840bc/88ae8/andrico-karoulla.jpg 1x,\n/static/4b90edbe83ec53e57fb0cf1f4af840bc/0740f/andrico-karoulla.jpg 1.5x,\n/static/4b90edbe83ec53e57fb0cf1f4af840bc/c9264/andrico-karoulla.jpg 2x"
                }
              }
            },
            "fields": {
              "slug": "/contributors/andrico-karoulla/"
            }
          }
        }
      }
    },
    "pageContext": {
      "isCreatedByStatefulCreatePages": false,
      "slug": "/blog/2019-01-01-publish-multiple-gatsby-sites/",
      "prev": {
        "fields": {
          "slug": "/blog/2018-12-31-how-we-do-high-impact-ux-research/",
          "package": null,
          "released": true
        },
        "frontmatter": {
          "title": "How Gatsby does high-impact, low-effort UX research (and you can too!)",
          "draft": null,
          "canonicalLink": null,
          "publishedAt": null,
          "issue": null,
          "tags": [
            "ux",
            "user-testing"
          ]
        }
      },
      "next": {
        "fields": {
          "slug": "/blog/2018-12-19-gatsby-scales-with-expertise-and-scope/",
          "package": null,
          "released": true
        },
        "frontmatter": {
          "title": "How Gatsby scales with your expertise & scope",
          "draft": null,
          "canonicalLink": "https://www.lekoarts.de/en/blog/how-gatsby-scales-with-your-expertise-and-scope",
          "publishedAt": "lekoarts.de",
          "issue": null,
          "tags": null
        }
      }
    }
  },
  "query": "query usersMisiekDevGatsbyWwwSrcTemplatesTemplateBlogPostJs2991924798(\n  $slug: String!\n) {\n  mdx(fields: {slug: {eq: $slug}}) {\n    body\n    excerpt\n    timeToRead\n    fields {\n      slug\n      publishedAt\n    }\n    frontmatter {\n      title\n      excerpt\n      date(formatString: \"MMMM Do YYYY\")\n      rawDate: date\n      canonicalLink\n      tags\n      image {\n        childImageSharp {\n          resize(width: 1500, height: 1500) {\n            src\n          }\n          fluid(maxWidth: 786) {\n            ...GatsbyImageSharpFluid\n          }\n        }\n      }\n      imageAuthor\n      imageAuthorLink\n      imageTitle\n      showImageInArticle\n      author {\n        id\n        bio\n        twitter\n        avatar {\n          childImageSharp {\n            fixed(width: 64, height: 64, quality: 75, traceSVG: {turdSize: 10, background: \"#f6f2f8\", color: \"#e0d6eb\"}) {\n              ...GatsbyImageSharpFixed_tracedSVG\n            }\n          }\n        }\n        fields {\n          slug\n        }\n      }\n    }\n  }\n}\n\nfragment GatsbyImageSharpFluid on ImageSharpFluid {\n  base64\n  aspectRatio\n  src\n  srcSet\n  sizes\n}\n\nfragment GatsbyImageSharpFixed_tracedSVG on ImageSharpFixed {\n  tracedSVG\n  width\n  height\n  src\n  srcSet\n}\n"
}