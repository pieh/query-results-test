{
  "path": "/docs/deploying-to-s3-cloudfront/",
  "result": {
    "data": {
      "mdx": {
        "body": "function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Deploying to S3/Cloudfront\"\n};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"In this guide, we\\u2019ll walk through how to host & publish your next Gatsby site to AWS using \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://aws.amazon.com/s3/\"\n  }), \"S3\"), \".\\nAdditionally - but very recommended - you can add CloudFront, a global CDN to make your site \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"even faster\"), \".\"), mdx(\"h2\", {\n    \"id\": \"getting-started---aws-cli\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#getting-started---aws-cli\",\n    \"aria-label\": \"getting started   aws cli permalink\",\n    \"className\": \"anchor\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"Getting Started - AWS CLI\"), mdx(\"p\", null, \"Create a \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://console.aws.amazon.com/iam/home?#\"\n  }), \"IAM account\"), \" with administration permissions and create a access id and secret for it.\\nYou\\u2019ll need these in the next step.\"), mdx(\"p\", null, \"Install the AWS CLI and configure it (ensure python is installed before running these commands)\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-shell\"\n  }), \"pip install awscli\\naws configure\\n\")), mdx(\"p\", null, \"The AWS CLI will now prompt you for the key & secret, add them.\"), mdx(\"h2\", {\n    \"id\": \"setting-up-s3\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#setting-up-s3\",\n    \"aria-label\": \"setting up s3 permalink\",\n    \"className\": \"anchor\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"Setting up: S3\"), mdx(\"p\", null, \"Now that we have our Gatsby site up & running, and our AWS access sorted out: let\\u2019s add hosting & make the site live on AWS.\"), mdx(\"p\", null, \"First, we\\u2019ll install the Gatsby S3 plugin:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-shell\"\n  }), \"npm i gatsby-plugin-s3\\n\")), mdx(\"p\", null, \"Add it to your \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"gatsby-config.js\"), \": (don\\u2019t forget to change the bucket name)\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"plugins: [\\n {\\n     resolve: `gatsby-plugin-s3`,\\n     options: {\\n         bucketName: 'my-website-bucket'\\n     },\\n },\\n]\\n\")), mdx(\"p\", null, \"And finally, add the deployment script to your \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"package.json\"), \":\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"\\\"scripts\\\": {\\n   ...\\n   \\\"deploy\\\": \\\"gatsby-plugin-s3 deploy\\\"\\n}\\n\")), mdx(\"p\", null, \"That\\u2019s it!\\nRun \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"npm run build && npm run deploy\"), \" to do a build and have it immediately deployed to S3!\"), mdx(\"h2\", {\n    \"id\": \"setting-up-cloudfront\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#setting-up-cloudfront\",\n    \"aria-label\": \"setting up cloudfront permalink\",\n    \"className\": \"anchor\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"Setting up: CloudFront\"), mdx(\"p\", null, \"CloudFront is a global CDN and can be used to make your blazing fast Gatsby site load \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"even faster\"), \", particularly for first-time visitors. Additionally, CloudFront provides the easiest way to give your S3 bucket a custom domain name and HTTPS support.\"), mdx(\"p\", null, \"There are a couple of things that you need to consider when using gatsby-plugin-s3 to deploy a site which uses CloudFront.\"), mdx(\"p\", null, \"There are two ways that you can connect CloudFront to an S3 origin. The most obvious way, which the AWS Console will suggest, is to type the bucket name in the Origin Domain Name field. This sets up an S3 origin, and allows you to configure CloudFront to use IAM to access your bucket. Unfortunately, it also makes it impossible to perform serverside (301/302) redirects, and it also means that directory indexes (having index.html be served when someone tries to access a directory) will only work in the root directory. You might not initially notice these issues, because Gatsby\\u2019s clientside JavaScript compensates for the latter and plugins such as \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"gatsby-plugin-meta-redirect\"), \" can compensate for the former. But just because you can\\u2019t see these issues, doesn\\u2019t mean they won\\u2019t affect search engines.\"), mdx(\"p\", null, \"In order for all the features of your site to work correctly, you must instead use your S3 bucket\\u2019s Static Website Hosting Endpoint as the CloudFront origin. This does (sadly) mean that your bucket will have to be configured for public-read, because when CloudFront is using an S3 Static Website Hosting Endpoint address as the Origin, it\\u2019s incapable of authenticating via IAM.\"), mdx(\"h3\", {\n    \"id\": \"gatsby-plugin-s3-configuration\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"href\": \"#gatsby-plugin-s3-configuration\",\n    \"aria-label\": \"gatsby plugin s3 configuration permalink\",\n    \"className\": \"anchor\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"gatsby-plugin-s3 configuration\"), mdx(\"p\", null, \"In the gatsby-plugin-s3 configuration file, there are a couple of optional parameters that you can usually leave blank, \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"protocol\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"hostname\"), \". But when you\\u2019re using CloudFront, these parameters are vital for ensuring redirects work correctly. If you omit these parameters, redirects will be performed relative to your S3 Static Website Hosting Endpoint. This means if a user visits your site via the CloudFront URL and hits a redirect, they will be redirected to your S3 Static Website Hosting Endpoint instead. This will disable HTTPS and (more importantly) will display an ugly and unprofessional URL in the user\\u2019s address bar.\"), mdx(\"p\", null, \"By specifying the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"protocol\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"hostname\"), \" parameters, you can cause redirects to be applied relative to a domain of your choosing.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-javascript\"\n  }), \"{\\n    resolve: `gatsby-plugin-s3`,\\n    options: {\\n        bucketName: \\\"my-example-bucket\\\",\\n        protocol: \\\"https\\\",\\n        hostname: \\\"www.example.com\\\",\\n    },\\n}\\n\")), mdx(\"p\", null, \"If you use your site\\u2019s URL elsewhere in gatsby-config.js, I have a tip for you. You can define the URL once at the top of the config:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-javascript\"\n  }), \"const siteAddress = new URL(\\\"https://www.example.com\\\")\\n\")), mdx(\"p\", null, \"And then in the Gatsby config you can reference it like so:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-javascript\"\n  }), \"{\\n    resolve: `gatsby-plugin-s3`,\\n    options: {\\n        bucketName: \\\"my-example-bucket\\\",\\n        protocol: siteAddress.protocol.slice(0, -1),\\n        hostname: siteAddress.hostname,\\n    },\\n}\\n\")), mdx(\"p\", null, \"If you need the full address elsewhere in your config, you can access it via \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"siteAddress.href\"), \".\"), mdx(\"h2\", {\n    \"id\": \"references\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#references\",\n    \"aria-label\": \"references permalink\",\n    \"className\": \"anchor\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"References:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://blog.joshwalsh.me/aws-gatsby/\"\n  }), \"Gatsby on AWS, the right way\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://github.com/jariz/gatsby-plugin-s3/blob/master/recipes/with-cloudfront.md\"\n  }), \"Using CloudFront with gatsby-plugin-s3\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"/blog/2018-08-24-gatsby-aws-hosting/\"\n  }), \"Publishing Your Next Gatsby Site to AWS With AWS Amplify\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"/blog/2018-06-14-escalade-sports-from-5000-to-5-in-hosting/\"\n  }), \"Escalade Sports: From $5000 to \\\\$5/month in Hosting With Gatsby\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://benenewton.com/deploy-your-gatsby-js-site-to-aws-s-3\"\n  }), \"Deploy your Gatsby.js Site to AWS S3\"))));\n}\n;\nMDXContent.isMDXComponent = true;",
        "excerpt": "In this guide, we'll walk through how to host & publish your next Gatsby site to AWS using  S3 .\nAdditionally - but very recommended - youâ€¦",
        "timeToRead": 2,
        "tableOfContents": {
          "items": [
            {
              "url": "#getting-started---aws-cli",
              "title": "Getting Started - AWS CLI"
            },
            {
              "url": "#setting-up-s3",
              "title": "Setting up: S3"
            },
            {
              "url": "#setting-up-cloudfront",
              "title": "Setting up: CloudFront",
              "items": [
                {
                  "url": "#gatsby-plugin-s3-configuration",
                  "title": "gatsby-plugin-s3 configuration"
                }
              ]
            },
            {
              "url": "#references",
              "title": "References:"
            }
          ]
        },
        "fields": {
          "slug": "/docs/deploying-to-s3-cloudfront/",
          "anchor": "deploying-to-s3-cloudfront"
        },
        "frontmatter": {
          "title": "Deploying to S3/Cloudfront",
          "overview": null,
          "issue": null,
          "disableTableOfContents": null,
          "tableOfContentsDepth": null
        },
        "parent": {
          "__typename": "File",
          "relativePath": "docs/deploying-to-s3-cloudfront.md"
        }
      }
    },
    "pageContext": {
      "isCreatedByStatefulCreatePages": false,
      "slug": "/docs/deploying-to-s3-cloudfront/",
      "prev": {
        "title": "Deploying to AWS Amplify",
        "link": "/docs/deploying-to-aws-amplify/",
        "breadcrumbTitle": "AWS Amplify"
      },
      "next": {
        "title": "Deploying to Aerobatic",
        "link": "/docs/deploying-to-aerobatic/",
        "breadcrumbTitle": "Aerobatic"
      }
    }
  },
  "query": "query usersMisiekDevGatsbyWwwSrcTemplatesTemplateDocsMarkdownJs2546709735(\n  $path: String!\n) {\n  mdx(fields: {slug: {eq: $path}}) {\n    body\n    excerpt\n    timeToRead\n    tableOfContents\n    fields {\n      slug\n      anchor\n    }\n    frontmatter {\n      title\n      overview\n      issue\n      disableTableOfContents\n      tableOfContentsDepth\n    }\n    ...MarkdownPageFooterMdx\n  }\n}\n\nfragment MarkdownPageFooterMdx on Mdx {\n  parent {\n    __typename\n    ... on File {\n      relativePath\n    }\n  }\n}\n"
}